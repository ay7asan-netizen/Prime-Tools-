<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prime Tools</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="card">
    <div class="header">
      <div class="brand">
        <h1 data-i18n="appTitle">Prime Tools</h1>
        <small><a class="link" href="admin.html" data-i18n="adminLink">ููุทูุฉ ุงูุฅุฏุงุฑุฉ</a></small>
      </div>
      <div class="lang-switch">
        <button class="lang" data-lang="ar" data-i18n="langAr">AR</button>
        <button class="lang" data-lang="en" data-i18n="langEn">EN</button>
        <button class="lang" data-lang="de" data-i18n="langDe">DE</button>
      </div>
    </div>

    <form id="loginForm" class="form" autocomplete="on">
      <label for="email" data-i18n="emailLabel">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
      <input id="email" type="email" inputmode="email" placeholder="example@mail.com" required />

      <label for="password" data-i18n="passLabel">ูููุฉ ุงููุฑูุฑ</label>
      <div class="password-wrap">
        <input id="password" type="password" required />
        <button type="button" id="togglePwd" class="eye" aria-label="Toggle password">๐๏ธ</button>
      </div>

      <label class="keep">
        <input type="checkbox" id="keepSignedIn" />
        <span data-i18n="keepLogin">ุงุจููู ูุณุฌูุงู ููุฏุฎูู</span>
      </label>

      <button id="loginBtn" type="submit" class="btn btn-primary" data-i18n="login">ุชุณุฌูู ุงูุฏุฎูู</button>
    </form>

    <p id="authMsg" class="notice"></p>
  </main>

  <!-- Firebase v9 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getAuth, setPersistence, browserLocalPersistence, browserSessionPersistence,
      signInWithEmailAndPassword, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCEbKMZHqJQ-UU6Qco7FlAue0E4mCWd4UY",
      authDomain: "prime-tools99.firebaseapp.com",
      projectId: "prime-tools99",
      storageBucket: "prime-tools99.appspot.com",
      messagingSenderId: "112360376529",
      appId: "1:112360376529:web:f5fac1d99a87f7f5a85df0",
      measurementId: "G-WR5IJ3CZ3K"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // ===== I18N =====
    const translations = {
      ar:{appTitle:"Prime Tools",adminLink:"ููุทูุฉ ุงูุฅุฏุงุฑุฉ",emailLabel:"ุงูุจุฑูุฏ ุงูุฅููุชุฑููู",passLabel:"ูููุฉ ุงููุฑูุฑ",
          keepLogin:"ุงุจููู ูุณุฌูุงู ููุฏุฎูู",login:"ุชุณุฌูู ุงูุฏุฎูู",langAr:"AR",langEn:"EN",langDe:"DE",
          success:"ุชู ุชุณุฌูู ุฏุฎููู ุจูุฌุงุญ โ", wrong:"ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ"},
      en:{appTitle:"Prime Tools",adminLink:"Admin area",emailLabel:"E-mail",passLabel:"Password",
          keepLogin:"Keep me signed in",login:"Sign in",langAr:"AR",langEn:"EN",langDe:"DE",
          success:"Signed in successfully โ", wrong:"Invalid credentials"},
      de:{appTitle:"Prime Tools",adminLink:"Adminbereich",emailLabel:"E-Mail",passLabel:"Passwort",
          keepLogin:"Angemeldet bleiben",login:"Anmelden",langAr:"AR",langEn:"EN",langDe:"DE",
          success:"Erfolgreich angemeldet โ", wrong:"Ungรผltige Anmeldedaten"}
    };
    const DIR={ar:"rtl",en:"ltr",de:"ltr"};
    let currentLang=localStorage.getItem("lang")||"ar";
    function applyLang(){
      const t=translations[currentLang];
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const k=el.getAttribute("data-i18n"); if(t[k]!==undefined) el.textContent=t[k];
      });
      document.documentElement.lang=currentLang;
      document.documentElement.dir=DIR[currentLang];
      document.querySelectorAll(".lang").forEach(b=>b.classList.toggle("active",b.dataset.lang===currentLang));
    }
    document.querySelectorAll(".lang").forEach(btn=>btn.addEventListener("click",()=>{
      currentLang=btn.dataset.lang; localStorage.setItem("lang",currentLang); applyLang();
    }));
    applyLang();

    // ===== Password toggle =====
    const pwd=document.getElementById("password");
    document.getElementById("togglePwd").addEventListener("click",()=>{pwd.type=pwd.type==="password"?"text":"password"});

    // ===== Login =====
    const emailEl=document.getElementById("email");
    const keepEl=document.getElementById("keepSignedIn");
    const msg=document.getElementById("authMsg");

    // Prefill saved email
    const savedEmail=localStorage.getItem("savedEmail"); if(savedEmail) emailEl.value=savedEmail;

    document.getElementById("loginForm").addEventListener("submit",async e=>{
      e.preventDefault(); msg.textContent="";
      const email=emailEl.value.trim(), pass=pwd.value.trim(); if(!email||!pass) return;

      try{
        await setPersistence(auth, keepEl.checked?browserLocalPersistence:browserSessionPersistence);
        localStorage.setItem("savedEmail", email);
        await signInWithEmailAndPassword(auth,email,pass);
        msg.textContent=translations[currentLang].success;
      }catch(err){
        console.error(err); msg.classList.add("error"); msg.textContent=translations[currentLang].wrong;
      }
    });

    onAuthStateChanged(auth, user => {
      // ุจุฅููุงูู ุชูุฌูู ุงููุณุชุฎุฏู ูุตูุญุฉ ุฃุฏูุงุช ุจุนุฏ ูุฌุงุญ ุงูุฏุฎูู
      // console.log("User:", user?.uid);
    });
  </script>
</body>
</html>
