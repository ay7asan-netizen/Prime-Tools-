<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="title">Prime Tools â€” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <style>
    body{margin:0;background:#0e0e10;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Tajawal,sans-serif}
    .wrap{max-width:420px;margin:40px auto;padding:0 16px}
    .card{background:#141418;border:1px solid #27272a;border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 14px}
    .field{position:relative;margin-top:10px}
    input{width:100%;padding:12px 44px 12px 12px;border-radius:10px;border:1px solid #303036;background:#0f0f12;color:#fff}
    .eye{position:absolute;left:10px;top:50%;transform:translateY(-50%);cursor:pointer;user-select:none;opacity:.8}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:10px;flex-wrap:wrap}
    .btn{width:100%;padding:12px;border:none;border-radius:10px;background:#27b0ff;color:#061019;font-weight:800;cursor:pointer;margin-top:12px}
    .muted{color:#a6a6b0;font-size:14px;margin-top:10px}
    a{color:#9cd2ff;text-decoration:none}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:12px}
    .link{color:#9cd2ff;text-decoration:none;font-size:14px;white-space:nowrap}
    .langbar{display:flex;gap:8px;align-items:center}
    .lang{cursor:pointer;opacity:.8;border:1px solid #2a2a2f;border-radius:999px;padding:6px 10px}
    .lang.active{opacity:1;background:#1b1b21}
    label{display:block;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <h1 data-i18n="brand">Prime Tools</h1>
        <div class="langbar">
          <span class="lang" data-lang="ar">AR</span>
          <span class="lang" data-lang="en">EN</span>
          <span class="lang" data-lang="de">DE</span>
          <a class="link" href="admin.html" data-i18n="adminPanel">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</a>
        </div>
      </div>

      <label data-i18n="emailLabel">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <div class="field">
        <input id="email" type="email" placeholder="example@mail.com" autocomplete="username" />
      </div>

      <label style="margin-top:10px" data-i18n="passLabel">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <div class="field">
        <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
        <span id="toggle" class="eye">ğŸ‘ï¸</span>
      </div>

      <div class="row">
        <label style="display:flex;gap:8px;align-items:center">
          <input id="remember" type="checkbox" /> <span data-i18n="remember">ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ</span>
        </label>
        <span class="muted" data-i18n="noSelfSignup">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù‡Ù†Ø§ â€” ÙÙ‚Ø· Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†</span>
      </div>

      <button class="btn" id="loginBtn" data-i18n="loginBtn">Ø¯Ø®ÙˆÙ„</button>
      <div id="msg" class="muted"></div>
    </div>
  </div>

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/12.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.5.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore-compat.js"></script>

  <script>
    // === i18n ===
    const T = {
      ar: {
        title: "Prime Tools â€” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
        brand: "Prime Tools",
        adminPanel: "Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†",
        emailLabel: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
        passLabel: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
        remember: "ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ",
        noSelfSignup: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù‡Ù†Ø§ â€” ÙÙ‚Ø· Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†",
        loginBtn: "Ø¯Ø®ÙˆÙ„",
        errNoUser: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ù…Ø³ØªØ®Ø¯Ù….",
        errNotApproved: "Ø­Ø³Ø§Ø¨Ùƒ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„."
      },
      en: {
        title: "Prime Tools â€” Sign in",
        brand: "Prime Tools",
        adminPanel: "Admin Panel",
        emailLabel: "Email",
        passLabel: "Password",
        remember: "Remember me",
        noSelfSignup: "No self-signup â€” Admin only",
        loginBtn: "Sign in",
        errNoUser: "User profile not found.",
        errNotApproved: "Your account is not approved."
      },
      de: {
        title: "Prime Tools â€” Anmeldung",
        brand: "Prime Tools",
        adminPanel: "Adminbereich",
        emailLabel: "E-Mail",
        passLabel: "Passwort",
        remember: "Angemeldet bleiben",
        noSelfSignup: "Keine Selbstregistrierung â€” nur Admin",
        loginBtn: "Anmelden",
        errNoUser: "Benutzerprofil nicht gefunden.",
        errNotApproved: "Ihr Konto ist nicht freigegeben."
      }
    };

    function applyLang(lang){
      const dict = T[lang] || T.ar;
      document.documentElement.lang = lang;
      document.documentElement.dir  = (lang==='ar'?'rtl':'ltr');
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(dict[key]) el.textContent = dict[key];
      });
      document.title = dict.title;
      // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
      document.querySelectorAll('.lang').forEach(b=>{
        b.classList.toggle('active', b.dataset.lang===lang);
      });
      localStorage.setItem('pt_lang', lang);
    }

    document.addEventListener('click', (e)=>{
      const b = e.target.closest('.lang');
      if(!b) return;
      applyLang(b.dataset.lang);
    });

    // Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ©
    applyLang(localStorage.getItem('pt_lang') || 'ar');

    // === Firebase ===
    const firebaseConfig = {
      apiKey: "AIzaSyCEbKMZHqJQ-UU6Qco7FlAue0E4mCWd4UY",
      authDomain: "prime-tools99.firebaseapp.com",
      projectId: "prime-tools99",
      storageBucket: "prime-tools99.firebasestorage.app",
      messagingSenderId: "112360376529",
      appId: "1:112360376529:web:f5fac1d99a87f7f5a85df0"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    document.getElementById('toggle').onclick = ()=>{
      const p = document.getElementById('password');
      p.type = (p.type === 'password') ? 'text' : 'password';
    };

    // ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ = LOCAL | Ø¨Ø¯ÙˆÙ† ØªØ°ÙƒÙ‘Ø± = SESSION
    async function setPersistence(remember){
      const kind = remember ? firebase.auth.Auth.Persistence.LOCAL
                            : firebase.auth.Auth.Persistence.SESSION;
      await auth.setPersistence(kind);
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById('loginBtn').onclick = async ()=>{
      const email = document.getElementById('email').value.trim();
      const pass  = document.getElementById('password').value;
      const remember = document.getElementById('remember').checked;
      const msg = document.getElementById('msg');
      msg.textContent = '';
      try{
        await setPersistence(remember);
        const cred = await auth.signInWithEmailAndPassword(email, pass);
        const udoc = await db.collection('users').doc(cred.user.uid).get();
        const lang = localStorage.getItem('pt_lang') || 'ar';
        const dict = T[lang];

        if(!udoc.exists) { msg.textContent = dict.errNoUser; await auth.signOut(); return; }
        const u = udoc.data();
        if(u.status !== 'approved'){ msg.textContent = dict.errNotApproved; await auth.signOut(); return; }

        window.location.href = 'user.html';
      }catch(e){
        msg.textContent = e.message;
      }
    };
  </script>
</body>
</html>
