<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prime Tools</title>
<style>
body { font-family: sans-serif; background:#111; color:#fff; padding:20px; }
input,button { width:100%; padding:12px; margin-top:10px; border-radius:8px; }
input { border:1px solid #444; background:#222; color:#fff; }
button { background:#0a84ff; border:none; font-size:16px; font-weight:bold; }
h2 { text-align:center; }
</style>
</head>

<body>

<h2>تسجيل الدخول</h2>
<input id="email" placeholder="البريد الإلكتروني">
<input id="password" placeholder="كلمة المرور" type="password">
<button onclick="login()">دخول</button>

<h2>إنشاء حساب</h2>
<input id="fname" placeholder="الاسم الأول">
<input id="lname" placeholder="اسم العائلة">
<input id="address" placeholder="العنوان">
<input id="emailReg" placeholder="البريد الإلكتروني">
<input id="passReg" placeholder="كلمة المرور" type="password">
<button onclick="register()">تسجيل</button>

<p id="msg"></p>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.5.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.5.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEbKMZHqJQ-UU6Qco7FlAue0E4mCWd4UY",
  authDomain: "prime-tools99.firebaseapp.com",
  projectId: "prime-tools99",
  storageBucket: "prime-tools99.firebasestorage.app",
  messagingSenderId: "112360376529",
  appId: "1:112360376529:web:f5fac1d99a87f7f5a85df0"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

async function login(){
 let email = document.getElementById("email").value;
 let pass = document.getElementById("password").value;
 auth.signInWithEmailAndPassword(email,pass).then(async res=>{
   let uid = res.user.uid;
   let doc = await db.collection("users").doc(uid).get();
   if(!doc.exists) return alert("لا يوجد ملف مستخدم");
   if(doc.data().status !== "approved") return alert("حسابك قيد المراجعة");
   alert("تم الدخول ✅");
   window.location.href="user.html";
 }).catch(e=>alert(e.message));
}

async function register(){
 let fname = document.getElementById("fname").value;
 let lname = document.getElementById("lname").value;
 let addr = document.getElementById("address").value;
 let email = document.getElementById("emailReg").value;
 let pass = document.getElementById("passReg").value;

 auth.createUserWithEmailAndPassword(email,pass).then(async res=>{
   let uid = res.user.uid;
   await db.collection("users").doc(uid).set({
     firstName: fname,
     lastName: lname,
     address: addr,
     email: email,
     status: "approved", /* خليها approved مؤقتًا للتشغيل */
     isAdmin: false
   });
   alert("تم إنشاء الحساب يمكنك الدخول ✅");
 }).catch(e=>alert(e.message));
}
</script>
</body>
</html>
